# ポイント制 抽選ツール

ブラウザだけで動く、ポイント（重み）に基づく抽選ツールです。候補者リストを複数（A/B/C）入力し、各リストに付与するポイントを設定すると、合計ポイントに比例した確率で当選者を選びます。除外リスト、重複行の扱い、最小ポイントのしきい値、商品ごとの当選人数などを柔軟に設定できます。

- 対象: そのまま `index.html` を開ける環境（PC/スマホのモダンブラウザ）
- 依存: なし（ビルド不要のスタンドアロン HTML）
- ファイル: `index.html` のみ（オフライン対応）

## 主な機能
- 複数リスト: `A/B/C` それぞれにポイント（重み）を設定可能。重複する名前はポイントを合算
- 除外設定: 除外リストの名前は抽選対象から除外
- 重複処理: 「同一リスト内の重複行は1件として扱う」を選択可（デフォルトON）
- 最小ポイント: しきい値未満の候補を自動除外（0ポイントは常に対象外）
- 商品・景品: 商品名と当選人数を複数追加。商品間での重複当選は自動防止
- 確率表示: 「確率を計算」で各候補の当選確率（%）を一覧表示
- 抽選結果: モーダルで当選者を表示。名前／CSV のコピーに対応
- 保存/復元: 入力内容・設定をローカルストレージに保存/読込
- テーマ: ライト/ダーク切替。設定は次回起動時に復元
- 整形ツール: 「@」始まりの行だけを抽出する整形（重複除去付き）
- モバイル対応: スマホでも操作しやすいUI
- 乱数: `crypto.getRandomValues` を優先使用（不可環境では `Math.random` にフォールバック）

## クイックスタート
1. `index.html` をブラウザで開く
2. 「リストA/B/C」に候補者を1行1名で入力し、各リストのポイントを設定
3. 必要に応じて「＋ 追加のリスト/除外を表示」から除外リスト・最小ポイント・重複行の扱いを調整
4. 「商品名」「当選人数」を設定し、必要なら「+ 商品を追加」で複数商品を登録
5. 「確率を計算」で確率を確認、または「抽選する」で当選者を決定
6. 結果モーダルから「名前をコピー」「CSVをコピー」を利用
7. 「保存」で入力・設定をローカル保存。「リセット」で初期化

## 仕様の詳細
- 同一判定（正規化）: `trim → NFKC 正規化(可能なら) → 小文字化` したキーで名前の同一性を判定
- ポイントの合算: 同じ参加者名がA/B/Cに存在する場合は、各リストのポイントを合算
- 最小ポイント: 設定値未満の候補は抽選対象外。0ポイントは常に対象外
- 抽選ロジック: 商品ごとに「重み付きランダム抽選」を繰り返し、当選者は候補集合から除外して重複当選を防止
- 商品名の自動設定: 未入力時は「1等」「2等 (n名)」のように自動命名
- 当選人数の範囲: 1〜1000
- クリップボード: Clipboard API を優先し、不可時はフォールバック（テキストエリア + `execCommand('copy')`）

## 入出力例
- CSV（商品別抽選）: `product,name,points`
- CSV（単純抽選）: `name,points`

## よくある質問（FAQ）
- 重複行の扱い: 「同一リスト内の重複行は1件として扱う」をONにすると、同一リストで同じ名前が複数行あっても1件としてカウントします。別リストに同名がある場合はポイントを合算します
- 「@」整形の意味: ごちゃ混ぜのリストから、`@` で始まる行だけを抽出して重複を除去します（ツールと各リストのインライン整形の両方あり）
- 0ポイントの候補: 自動的に抽選対象外です。最小ポイントもしきい値で除外できます
- 乱数の品質: 対応ブラウザでは `crypto.getRandomValues` を利用します。未対応環境では `Math.random` へフォールバックします

## 動作環境
- 最新の Chrome/Edge/Firefox/Safari を推奨
- クリップボード利用時は権限が必要な場合があります
- 暗号学的乱数は対応ブラウザでのみ利用可能

## プライバシー
- 本ツールはネットワーク通信を行いません
- 入力・設定はブラウザの LocalStorage に保存されます
  - `lottery_data`: 入力・設定一式
  - `lottery_theme`: テーマ（`light`/`dark`）
  - `lottery_adv_open`: 追加セクションの開閉状態

## デプロイ
- どの静的ホスティングでも `index.html` を配置するだけで稼働します
- GitHub Pages の場合は、ブランチまたは `docs/` 配下に `index.html` を配置

## 開発
- ビルド工程なし。`index.html` を直接メンテナンスしてください
- 機能追加の提案は issue/PR で相談ください

## 既知の制限 / 注意点
- 候補数が非常に多い場合、ブラウザ性能により描画やアニメーションが重くなることがあります
- 名前の同一判定は正規化後の文字列一致です（完全一致）。誤差マッチや類似検索は行いません
- 商品間の重複当選は防止されますが、抽選対象のポイントや候補は抽選開始時点の状態で固定されます

## ライセンス
- ライセンスは未指定です。必要に応じて `LICENSE` を追加してください
